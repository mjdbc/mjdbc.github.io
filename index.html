<!DOCTYPE html>
<html lang=en>
<head>
    <meta charset=utf-8>
    <meta http-equiv=X-UA-Compatible content="IE=edge">
    <meta name=viewport content="width=device-width,initial-scale=1">
    <meta name=description content="mjdbc - small and efficient JDBC wrapper">
    <meta name=keywords content="jdbc, java, jdbi, mjdbc, sql, mapper, transaction, ORM">
    <meta name=author content="Mikhail Fursov and mjdbc contributors">
    <title>mJDBC - small and efficient JDBC wrapper</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" crossorigin="anonymous">
    <link rel="stylesheet" href="site.css">


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>

</head>
<body>

<div class="bs-docs-header" id="content" tabindex="-1">
    <div class="container">
        <h1 class="logo-header">mJDBC<sub>v1.0.0</sub></h1>
        <div class="header-text">компактная, простая и удобная библиотека для
            <a href="https://en.wikipedia.org/wiki/Java_Database_Connectivity" target="_blank">JDBC</a>
        </div>
        <div class="header-links-block">
            <a href="" class="btn btn-default btn-sm btn-header" target="_blank">Maven</a>
            <a href="http://github.com/mjdbc/mjdbc" class="btn btn-default btn-sm btn-header" target="_blank">GitHub</a>
        </div>
    </div>
</div>

<div class="container bs-docs-main">
    <div class="row">
        <!--Main Content -->
        <div class="col-xs-9">
            <section id="GroupAbout" class="group">
                <h3>О библиотеке</h3>
                <ul class="feature-list">
                    <li><i>Компактность</i> - около 50кб, нет дополнительных зависимостей.</li>
                    <li><i>Простота</i> - не нужно учить лишнее. Инициализация: от 1 строки кода.</li>
                    <li><i>Надеждность</i> - SQL запросы проверяются на момент старта приложения.</li>
                    <li><i>Гибкость</i> - доступ к низкоуровневому функционалу JDBC.</li>
                    <li><i>Производительность</i> - нет дополнительных вычислительных расходов по сравнению с JDBC.</li>
                    <li><i>Транзакционность</i> - методы могут выполнять роль транзакций.</li>
                    <li><i>Скорость</i> - SQL соедиенение открывается в момент исполнения первого реального запроса.</li>
                    <li><i>Расширяемость</i> - регистрация новых типов данных, переопределение существующих.</li>
                    <li><i>Профилировка</i> - доступ метрикам исполнения запросов и транзакций.</li>
                    <li><i>Открытость</i> - открытый исходный код: возможность изменять и исправлять.</li>
                    <li><i>Надежность</i> - используется в реальных проектах.</li>
                </ul>
            </section>
            <section id="GroupInstall" class="group">
                <h3>Установка</h3>
                <div>
                    Добавьте следующий код в проектный файл Maven:
                    <pre class="prettyprint">
&lt;dependency&gt;
    &lt;groupId&gt;com.github.mjdbc&lt;/groupId&gt;
    &lt;artifactId&gt;mjdbc&lt;/artifactId&gt;
    &lt;version&gt;1.0.0&lt;/version&gt;
&lt;/dependency&gt;</pre>
                </div>
            </section>
            <section id="GroupExamples" class="group">
                <div id="GroupInstallExample" class="subgroup">
                    <h3>Примеры использования</h3>
                    Пример 1: SQL запросы
                    <pre class="prettyprint">
// Шаг 1: Создаем mJDBC адаптер для java.sql.DataSource
java.sql.DataSource ds = ...;
Db db = Db.newInstance(ds);

// Шаг 2: Описываем SQL интерфейс
public interface UserSql {
    @Sql("INSERT INTO users(login) VALUES (:login)")
    int insertUser(@BindBean User user);

    @Sql("SELECT * FROM users WHERE login = :login")
    User getUserByLogin(@Bind("login") String login)
}

// Шаг 3: Определяем правила считывания структур из ResultSet
db.registerMapper(User.class, (r) -> {
    User user = new User();
    user.id = r.getInt("id");
    user.login = r.getString("login");
    ...
    return user;
};)

// Шаг 4: Получаем реализацию SQL интерфейса
UserSql userSql = db.attachSql(UserSql.class);

// Шаг 5: Используем SQL интерфейс для исполнения запросов
User user = userSql.getUserByLogin('login');</pre>

                    Пример 2: Транзакции
                    <pre class="prettyprint">
// Шаг 1: Создаем интерфейс с транзакционными методами
public interface UserDbi {
    void registerUser(User user);
}

// Шаг 2: Имплементируем интерфейс
public class UserDbiImpl implements UserDbi {
    public void registerUser(User user) {
        User copy = userSql.getUserByLogin(user.login);
        assertNull(copy, "Пользователь уже существует: " + user.login);
        user.id = userSql.insertUser(user);
    }
}

// Шаг 3: Получаем транзакционный прокси-адаптер для интерфейса
UserDbi userDbi = db.attachDbi(UserDbi.class, new UserDbiImpl());

// Шаг 4: Используем адаптер для вызова методов имплементации
userDbi.registerUser(new User("root"));</pre>
                </div>
            </section>
            <section id="GroupAdapter" class="group">
                <h3>Обзор mJDBC адаптера</h3>
                <p>
                    Для того, чтобы начать использовать mJDBC необходимо создать адаптер типа <i>com.github.mjdbc.Db</i> поверх экземпляра <i>javax.sql.DataSource</i>.
                    Для этого нужно использовать статический метод-фабрику:</p>
                <pre class="prettyprint">
static Db newInstance(DataSource ds)</pre>
                <p><a href="#GroupTransactions"> Транзакционные интерфейсы</a> позволяют выполнить серию SQL-запросов как единую транзакцию давая гарантию, что либо все SQL операции внутри
                    транзакции будут завершены успешено, либо ни одна из них не будет иметь эффект при завершении транзакции.
                    Для регистрации транзакционных интерфейсов используйте следующий метод:
                </p>
                <pre class="prettyprint">
&lt;T&gt; T attachDbi(T impl, @NotNull Class&lt;T&gt; dbiInterface)</pre>
                <p><a href="#GroupSql">SQL интерфейсы</a> - выразительный способ описывать SQL запросы проверяемые на корректность на момент регистрации интерфейса.
                    Метод регистрации интерфейса возвращает Proxy-класс с реализацией SQL методов описанных в качестве @Sql аннотаций.
                <pre class="prettyprint">
&lt;T&gt; T attachSql(Class&lt;T&gt; sqlInterface);</pre>
                <p><a href="#GroupBinders">Типы параметров</a> для SQL интерфейсов могут быть расширены при помощи регистрации реализаций интерфейса <i>DbBinder</i>,
                    который обеспечивает отображение значения параметра в JDBC параметр для <i>java.sql.PreparedStatement</i></p>
                <pre class="prettyprint">
&lt;T&gt; void registerBinder(Class&lt;? extends T&gt; binderClass, DbBinder&lt;T&gt; binder)</pre>
                За <a href="#GroupMappers">возвращаемые значения</a> SQL запросов отвечают зарегистрированные экземпляры класса <i>DbMapper</i>.
                mJDBC поддерживает примитивные Java типы, JDBC типы и списки. Поддержка новых типов может быть расширена за счет использования следующего метода:
                <pre class="prettyprint">
&lt;T&gt; void registerMapper(Class&lt;T&gt; mapperClass, DbMapper&lt;T&gt; mapper);</pre>
                <p>Помимо создания транзакционных и SQL интерфейсов mJDBC позволяет создавать <a href="#GroupLowLevelApi">прямые запросы</a> к базе.
                    При этом вызванный метод будет обернут в транзакцию так, если бы использовался транзацкионный интерфейс.</p>
                <p>Внутри у метода будет доступ как к управляемому JDBC соединению (<i>DbConnection</i>), так и к <i>DbPreparedStatement</i> классу который поддерживает
                    работу с <i>DbBinder</i>/<i>DbMapper</i> и именованными параметрами. Помимо этого будет доступ к реальным JDBC объектам.</p>
                <p>Все вызовы mJDBC аннотированы с <i>@Nullable</i>/<i>@NotNull</i> аннотациями для жесткого контроля работы с нулевыми значениями.
                    Более того, операции которые могут и не могут возвращать нулевые значения разделены. </p>
                <pre class="prettyprint">
@Nullable
&lt;T&gt; T execute(@NotNull DbOp&lt;T&gt; op);

@NotNull
&lt;T&gt; T executeNN(@NotNull DbOpNN&lt;T&gt; op);

void executeV(@NotNull  DbOpV op);
                </pre>
                <p>
                    Доступ к простейшей <a href="#GroupProfiling">профилировочной информации</a> о числе вызовов и суммарном времени исполнения транзационных методов и SQL-запросов
                    можно получить используя метод <i>getTimers</i>:
                </p>
                <pre class="prettyprint">
Map&lt;Method, DbTimer&gt; getTimers();</pre>
            </section>
            <section id="GroupTransactions" class="group">
                <h3>Транзакции</h3>
            </section>
            <section id="GroupSql" class="group">
                <h3>SQL интерфейс</h3>
            </section>
            <section id="GroupBinders" class="group">
                <h3>SQL параметры</h3>
            </section>
            <section id="GroupMappers" class="group">
                <h3>SQL результаты</h3>
            </section>
            <section id="GroupBatch" class="group">
                <h3>Batch операции</h3>
            </section>
            <section id="GroupProfiling" class="group">
                <h3>Профилировка</h3>
            </section>
            <section id="GroupLowLevelApi" class="group">
                <h3>Низкоуровневый интерфейс</h3>
            </section>
            <section id="GroupRecommendations" class="group">
                <h3>Рекомендации</h3>
            </section>
        </div>
        <!--Nav Bar -->
        <nav class="col-xs-3 bs-docs-sidebar">
            <ul id="sidebar" class="nav nav-stacked fixed">
                <li><a href="#GroupAbout">О библиотеке</a></li>
                <li><a href="#GroupInstall">Установка</a></li>
                <li><a href="#GroupExamples">Примеры использования</a></li>
                <li><a href="#GroupAdapter">Обзор mJDBC адаптера</a></li>
                <li><a href="#GroupTransactions">Транзакции</a></li>
                <li><a href="#GroupBinders">SQL параметры</a></li>
                <li><a href="#GroupMappers">SQL результаты</a></li>
                <li><a href="#GroupBatch">Batch операции</a></li>
                <li><a href="#GroupProfiling">Профилировка</a></li>
                <li><a href="#GroupLowLevelApi">Низкоуровневый интерфейс</a></li>
                <li><a href="#GroupRecommendations">Рекомендации</a></li>
            </ul>
        </nav>
    </div>
</div>
<script>
    $('body').scrollspy({
        target: '.bs-docs-sidebar',
        offset: 40
    });
</script>
</body>
</html>
